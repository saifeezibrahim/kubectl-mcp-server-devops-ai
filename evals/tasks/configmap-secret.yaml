# Task: ConfigMap and Secret management
# Tests configuration management functionality

name: config-management
description: Create and manage ConfigMaps and Secrets
category: core

# Setup phase
setup:
  script: ./setup.sh

# The prompt to send to the AI agent
prompt: |
  In the eval-test namespace, create the following configuration resources:

  1. Create a ConfigMap named "app-config" with:
     - Key "database_host" = "postgres.db.svc.cluster.local"
     - Key "database_port" = "5432"
     - Key "log_level" = "info"

  2. Create a Secret named "app-secrets" with:
     - Key "database_password" = "secret123"
     - Key "api_key" = "key-abc-123"
     (These should be base64 encoded as required by Kubernetes)

  3. List the created ConfigMaps and Secrets to verify they exist

# Expected tool invocations and outputs
assertions:
  # ConfigMap creation
  - toolPattern: "(create_configmap|apply_manifest)"
  - outputContains: "configmap"
  - outputContains: "app-config"
  # Secret creation
  - toolPattern: "(create_secret|apply_manifest)"
  - outputContains: "secret"
  - outputContains: "app-secrets"
  # No errors
  - outputNotContains: "error"
  # Expected parameters
  - toolParams:
      namespace: "eval-test"

# Verification phase
verify:
  commands:
    # Check ConfigMap exists with correct data
    - kubectl get configmap app-config -n eval-test -o jsonpath='{.data.database_host}' | grep -q "postgres"
    - kubectl get configmap app-config -n eval-test -o jsonpath='{.data.log_level}' | grep -q "info"
    # Check Secret exists
    - kubectl get secret app-secrets -n eval-test
    # Verify secret has expected keys
    - kubectl get secret app-secrets -n eval-test -o jsonpath='{.data}' | grep -q "database_password"

# Cleanup phase
cleanup:
  commands:
    - kubectl delete configmap app-config -n eval-test --ignore-not-found
    - kubectl delete secret app-secrets -n eval-test --ignore-not-found

# Timeout in seconds
timeout: 60

# Tags for filtering
tags:
  - configmap
  - secret
  - configuration
  - core
